# 고민 사항
요구사항이 수정됨에 따라  /reservations 로 예약이 되던 시스템이

고객의 예약은 /reservations로 어드민의 예약추가는 /admin/reservations 로 처리되도록 요구사항이 변경되었습니다.

-> 그렇다면 이 때 AdminController를 추가로 만들 것인지 혹은 ReservationController의 RequestMapping을 제외하고 
ReservationController에서 예약과 관련된 모든 것들을 처리할 것인지 고민을 하였습니다.

1. AdminController를 만든다 -> 그렇다면 Theme, ReservationTime 같은 경우에는 오로지 어드민의 책임인데 (고객은 테마와 예약시간을 추가로 만들거나 삭제할 수 없다)
   (Theme, ReservationTime) Controller로 분리되어있는 것이 책임이 분산되어있다고 생각이 들어 찝찝하다.

2.ReservationController에서 처리한다.
* 가독성이 떨어진다.
* 한 곳에서 다 관리하는 것은 API 설계나 컨트롤러 설계가 잘못되었다.
(API 설계에서 하나의 컨트롤러에서 여러가지 prefix가 달라지는 것이 괜찮은가?)

이렇게 고민을 하다 2번을 골랐습니다.

우선 고르게 된 가장 큰 이유는  AdminController를 만들게 된다면 테마, 시간의 추가 및 삭제 또한 AdminController에 있어야 하는 것이 당연하다고 느껴지는데,
요구사항이 지금은 Reservation의 추가만 하라고 하니 그것만 하자는 것이 잘못된 설계인 것은 알지만, 요구사항을 따르라는 것 같아 2번을 골랐는데 이에 대해서 어떻게 생각하시는지 궁금합니다.
(물론 직장을 다니는 직원이라면 요구사항대로 하는 것이 맞지만, 배우는 입장에서 요구사항대로만 움직이는 것이 싫었다는 의미입니다)
---

1. 정상 작동

- [x] 시간 관리, 예약 관리 API가 적절한 응답을 하도록 변경

2. 예외 처리

- [x] 시간 생성 시 시작 시간이 유효하지 않은 값인 경우
- [x] 예약 생성 시 예약자명 / 날짜 / 시간에 유효하지 않은 값이 입력 되었을 때
- [x] 특정 시간에 대한 예약이 존재하는데, 그 시간을 삭제하려 할 때
- [x] 같은 날짜와 시각에 대한 예약이 존재하는데 등록하고자 할 때
- [x] 지나간 날짜와 시각에 대한 예약을 등록하고자 할 때
- [x] reservation_time 의 start_at 은 중복이 아니어야 한다.
- [x] theme 의 name 은 중복이 아니어야 한다.

3. 테마 요구사항

- [x] 테마 도메인 및 테이블 세팅하기
- [x] 관리자의 테마 관리 기능 구현
    - [x] 테마 조회
    - [x] 테마 추가
    - [x] 테마 삭제
- [x] 관리자가 예약 정보 등록 시에 테마 선택하도록 구현

4. 사용자 예약 요구사항

- [x] 테마 전체 조회 기능 구현
    - [x] 날짜를 선택했을 때 테마를 선택할 수 있도록 js 파일 수정
- [x] 예약 가능한 날짜 전체 조회 기능 구현
    - [x] 날짜와 테마에 따라 가능한 예약 시간들을 조회하는 API 추가
    - [x] 예약 시각들을 보여주는 js 파일 수정

5. 인기 테마 요구사항

- [x] 최근 일주일 기준 예약이 많은 테마 10개를 확인하는 API 추가
- [x] `/` 요청 시 `/templates/index.html` 을 응답하도록 한다

3. 테마 요구사항

- [x] 테마 도메인 및 테이블 세팅하기
- [x] 관리자의 테마 관리 기능 구현
    - [x] 테마 조회
    - [x] 테마 추가
    - [x] 테마 삭제
- [x] 관리자가 예약 정보 등록 시에 테마 선택하도록 구현

4. 사용자 로그인
- [x] 사용자 도메인을 추가
- [x] 로그인 기능을 구현
- [x] 로그인 후 Cookie를 이용하여 사용자의 정보를 조회하는 API를 구현
- [x] 인증 정보 조회(GET /login/check)하는 API 구현.

5. 로그인 리팩터링
- [x] 사용자의 정보를 조회하는 로직을 리팩터링 합니다.
    - [x] Cookie에 담긴 인증 정보를 이용해서 멤버 객체를 만드는 로직을 분리
      (HandlerMethodArgumentResolver을 활용하면 회원정보를 객체를 컨트롤러 메서드에 주입)
- [x] 예약 생성 API 및 기능을 리팩터링 합니다.
    - [x] 예약 생성 기능 변경 - 사용자
      사용자가 예약 생성 시, 로그인한 사용자 정보를 활용하도록 리팩터링 합니다.
      reservation.html, user-reservation.js 파일의 TODO 주석을 참고하여 변경된 명세에 맞게 클라이언트가 동작하도록 변경합니다.

6. 접근 권한 제어
- [x] Member의 Role이 ADMIN 인 사람만 /admin 으로 시작하는 페이지에 접근할 수 있습니다.
  - [x] HandlerInterceptor를 활용하여 권한을 확인하고, 권한이 없는 경우 요청에 대한 거부 응답을 하세요.

7. 예약 목록 검색
- [x] 예약이 많아질 경우 관리가 용이하도록 예약 검색 기능을 추가합니다.
- [x] 예약자별, 테마별, 날짜별 검색 조건을 사용해 예약 검색이 가능하도록 기능을 추가하세요.

### 추후 고려 사항

- FakeDao 를 사용하니 잡을 수 없는 예외(`DataIntegrityViolationException`) 가 있어 테스트 불가
